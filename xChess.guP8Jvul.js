import{d as E,_ as j,c as m,b as c,F as Q,h as W,o as y,n as H,t as S,a,f as V,q as nt,w as O,i as A,v as it,s as ot,p as ut,e as lt}from"./xindex.nwv0rKjI.js";const ht=E({props:["board","highlight","selected"],data(){return{}},methods:{clickSquare(t){this.$emit("clickSquare",t)},getHighlight(t){const s={};return this.highlight&&this.highlight.forEach(e=>{e.x===t.x&&e.y===t.y&&(s.highlight=!0)}),this.selected&&this.selected.x===t.x&&this.selected.y===t.y&&(s.selected=!0),s}}}),ct=["onClick"],pt={key:0,class:"piece"},rt={key:1,class:"piece"},at={key:2,class:"piece"},ft={key:3,class:"piece"},gt={key:4,class:"piece"},vt={key:5,class:"piece"},mt={key:6,class:"piece"},yt={key:7,class:"piece"},kt={key:8,class:"piece"},dt={key:9,class:"piece"},Pt={key:10,class:"piece"},Tt={key:11,class:"piece"},wt={key:12},Ct={key:13,class:"piece"};function $t(t,s,e,n,i,o){return y(),m("div",null,[c("table",null,[(y(!0),m(Q,null,W(t.board,(u,l)=>(y(),m("tr",{key:l},[(y(!0),m(Q,null,W(u,(r,v)=>(y(),m("td",{key:v,class:H(t.getHighlight({x:v,y:7-l})),onClick:I=>t.clickSquare({x:v,y:7-l})},[r==="K"?(y(),m("span",pt,"♔")):r==="Q"?(y(),m("span",rt,"♕")):r==="R"?(y(),m("span",at,"♖")):r==="B"?(y(),m("span",ft,"♗")):r==="N"?(y(),m("span",gt,"♘")):r==="P"?(y(),m("span",vt,"♙")):r==="k"?(y(),m("span",mt,"♚")):r==="q"?(y(),m("span",yt,"♛")):r==="r"?(y(),m("span",kt,"♜")):r==="b"?(y(),m("span",dt,"♝")):r==="n"?(y(),m("span",Pt,"♞")):r==="p"?(y(),m("span",Tt,"♟")):r==="/"||r===" "?(y(),m("span",wt)):(y(),m("span",Ct,S(r),1))],10,ct))),128))]))),128))])])}const Mt=j(ht,[["render",$t],["__scopeId","data-v-3cbc809a"]]),w="black",M="white";function T(t,s){return x(C(t))===x(C(s))}function x(t){const s=C(t),e=s.promoteTo?"="+s.promoteTo:"";return P(s.from)+"-"+P(s.to)+e}function C(t){if(typeof t=="string"){const[s,e]=t.split("="),[n,i]=s.split("-"),o={from:f(n),to:f(i)};return e&&(o.promoteTo=e),o}else return t}function h(t,s,e){const{x:n,y:i}=f(t),{x:o,y:u}=f(s),l={from:f(t),to:f([n+o,i+u])};return e&&(l.promoteTo=e),l}function Bt(t,s){return{from:f(t),to:f(s)}}function f(t){return typeof t=="string"?{x:{a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7}[t[0]],y:t[1]-1}:Array.isArray(t)?{x:t[0],y:t[1]}:t}function K(t,s){const e=f(t),n=f(s);return P(e)===P(n)}function P(t){if(t===null)return null;const s="abcdefgh",{x:e,y:n}=f(t);return s[e]+(n+1)}function _(t){const s="rnbkqp",e="RNBKQP";return s.indexOf(t)!==-1?w:e.indexOf(t)!==-1?M:t}function g(t,s){const{x:e,y:n}=f(s);return t[7-n][e]}function B(t,s){return _(g(t,s))}function F(t,s){return B(t,s)===w}function U(t,s){return B(t,s)===M}function k(t,s){return g(t,s)==="."}function N(t,s,e,n){return!(g(t,e)===n&&!s.find(i=>K(i,e)))}function d(t,s,e){const n=t.slice(0);let{x:i,y:o}=f(s);const u=n[7-o];return n[7-o]=u.substr(0,i)+e+u.substr(i+1),n}function Rt(t,s){for(let e=0;e<=7;e++)for(let n=0;n<=7;n++)if(g(t,[e,n])===s)return{x:e,y:n}}function G(t,s){const e=C(s),n=g(t,e.from);let i=d(t,e.from,".");if(i=d(i,e.to,n),n==="k")T(e,"e8-g8")?(i=d(i,"h8","."),i=d(i,"f8","r")):T(e,"e8-c8")&&(i=d(i,"a8","."),i=d(i,"d8","r"));else if(n==="K")T(e,"e1-g1")?(i=d(i,"h1","."),i=d(i,"f1","R")):T(e,"e1-c1")&&(i=d(i,"a1","."),i=d(i,"d1","R"));else if(n==="p"){const{x:o}=f(e.from),{x:u,y:l}=f(e.to);o!==u&&k(t,e.to)?i=d(i,[u,l+1],"."):l===0&&(i=d(i,[u,l],e.promoteTo.toLowerCase()))}else if(n==="P"){const{x:o}=f(e.from),{x:u,y:l}=f(e.to);o!==u&&k(t,e.to)?i=d(i,[u,l-1],"."):l===7&&(i=d(i,[u,l],e.promoteTo))}return i}function p(t,s,e,n){const i=[],{x:o,y:u}=f(e),l=B(t,s);let{x:r,y:v}=f(s);for(;r=r+o,v=v+u,!(r>7||v>7||r<0||v<0||(Nt(t,l,[r,v])&&i.push(Bt(s,[r,v])),n)||!St(t,[r,v])););return i}function Nt(t,s,e){return k(t,e)||B(t,e)!==s}function St(t,s){return k(t,s)}function z(t,s,e){const n=[];return n.push(...q(t,s,e)),n.push(...Ot(t,e)),n.push(...X(t,s,e)),n.push(...Dt(t,e)),n.push(...Y(t,e)),n.push(...Z(t,e)),n.push(...b(t,e)),n.push(...tt(t,e)),n.push(...et(t,e)),n.push(...At(t,s,e)),n}function J(t,s,e){const n=[];return n.push(...q(t,s,e)),n.push(...X(t,s,e)),n.push(...Y(t,e)),n.push(...Z(t,e)),n.push(...b(t,e)),n.push(...tt(t,e)),n.push(...et(t,e)),n}function q(t,s,e){const n=[];if(g(t,e)!=="P")return n;const{x:o,y:u}=f(e);if(o>0&&F(t,[o-1,u+1])&&(u===6?(n.push(h(e,[-1,1],"Q")),n.push(h(e,[-1,1],"R")),n.push(h(e,[-1,1],"B")),n.push(h(e,[-1,1],"N"))):n.push(h(e,[-1,1]))),o<7&&F(t,[o+1,u+1])&&(u===6?(n.push(h(e,[1,1],"Q")),n.push(h(e,[1,1],"R")),n.push(h(e,[1,1],"B")),n.push(h(e,[1,1],"N"))):n.push(h(e,[1,1]))),s&&s.length){const l=s[s.length-1],r=h([o+1,u+2],[0,-2]),v=h([o-1,u+2],[0,-2]);g(t,[o+1,u])==="p"&&T(l,r)&&n.push(h(e,[1,1])),g(t,[o-1,u])==="p"&&T(l,v)&&n.push(h(e,[-1,1]))}return n}function Ot(t,s){const e=[];if(g(t,s)!=="P")return e;const{x:i,y:o}=f(s);return k(t,[i,o+1])&&(o===6?(e.push(h(s,[0,1],"Q")),e.push(h(s,[0,1],"R")),e.push(h(s,[0,1],"B")),e.push(h(s,[0,1],"N"))):e.push(h(s,[0,1]))),o===1&&k(t,[i,o+1])&&k(t,[i,o+2])&&e.push(h(s,[0,2])),e}function X(t,s,e){const n=[];if(g(t,e)!=="p")return n;const{x:o,y:u}=f(e);if(o>0&&U(t,[o-1,u-1])&&(u===1?(n.push(h(e,[-1,-1],"Q")),n.push(h(e,[-1,-1],"R")),n.push(h(e,[-1,-1],"B")),n.push(h(e,[-1,-1],"N"))):n.push(h(e,[-1,-1]))),o<7&&U(t,[o+1,u-1])&&(u===1?(n.push(h(e,[1,-1],"Q")),n.push(h(e,[1,-1],"R")),n.push(h(e,[1,-1],"B")),n.push(h(e,[1,-1],"N"))):n.push(h(e,[1,-1]))),s&&s.length){const l=s[s.length-1],r=h([o+1,u-2],[0,2]),v=h([o-1,u-2],[0,2]);g(t,[o+1,u])==="P"&&T(l,r)&&n.push(h(e,[1,-1])),g(t,[o-1,u])==="P"&&T(l,v)&&n.push(h(e,[-1,-1]))}return n}function Dt(t,s){const e=[];if(g(t,s)!=="p")return e;const{x:i,y:o}=f(s);return k(t,[i,o-1])&&(o===1?(e.push(h(s,[0,-1],"Q")),e.push(h(s,[0,-1],"R")),e.push(h(s,[0,-1],"B")),e.push(h(s,[0,-1],"N"))):e.push(h(s,[0,-1]))),o===6&&k(t,[i,o-1])&&k(t,[i,o-2])&&e.push(h(s,[0,-2])),e}function Y(t,s){const e=[],n=g(t,s);return n!=="r"&&n!=="R"||(e.push(...p(t,s,[1,0])),e.push(...p(t,s,[-1,0])),e.push(...p(t,s,[0,1])),e.push(...p(t,s,[0,-1]))),e}function Z(t,s){const e=[],n=g(t,s);return n!=="q"&&n!=="Q"||(e.push(...p(t,s,[1,0])),e.push(...p(t,s,[-1,0])),e.push(...p(t,s,[0,1])),e.push(...p(t,s,[0,-1])),e.push(...p(t,s,[1,1])),e.push(...p(t,s,[-1,-1])),e.push(...p(t,s,[1,-1])),e.push(...p(t,s,[-1,1]))),e}function b(t,s){const e=[],n=g(t,s);return n!=="b"&&n!=="B"||(e.push(...p(t,s,[1,1])),e.push(...p(t,s,[-1,-1])),e.push(...p(t,s,[1,-1])),e.push(...p(t,s,[-1,1]))),e}function tt(t,s){const e=[],n=g(t,s);return n!=="n"&&n!=="N"||(e.push(...p(t,s,[2,1],!0)),e.push(...p(t,s,[2,-1],!0)),e.push(...p(t,s,[-2,1],!0)),e.push(...p(t,s,[-2,-1],!0)),e.push(...p(t,s,[1,2],!0)),e.push(...p(t,s,[1,-2],!0)),e.push(...p(t,s,[-1,2],!0)),e.push(...p(t,s,[-1,-2],!0))),e}function et(t,s){const e=[],n=g(t,s);return n!=="k"&&n!=="K"||(e.push(...p(t,s,[0,1],!0)),e.push(...p(t,s,[0,-1],!0)),e.push(...p(t,s,[1,0],!0)),e.push(...p(t,s,[-1,0],!0)),e.push(...p(t,s,[1,1],!0)),e.push(...p(t,s,[1,-1],!0)),e.push(...p(t,s,[-1,1],!0)),e.push(...p(t,s,[-1,-1],!0))),e}function At(t,s,e){const n=[],i=g(t,e);if(i!=="k"&&i!=="K")return n;const o=_(i),u=o===w?M:w;return $(t,e,u)||(o===M?N(t,s,"e1","K")||(!N(t,s,"h1","R")&&k(t,[5,0])&&k(t,[6,0])&&!$(t,[5,0],u)&&!$(t,[6,0],u)&&n.push(...p(t,e,[2,0],!0)),!N(t,s,"a1","R")&&k(t,[1,0])&&k(t,[2,0])&&k(t,[3,0])&&!$(t,[2,0],u)&&!$(t,[3,0],u)&&n.push(...p(t,e,[-2,0],!0))):N(t,s,"e8","k")||(!N(t,s,"h8","r")&&k(t,[5,7])&&k(t,[6,7])&&!$(t,[5,7],u)&&!$(t,[6,7],u)&&n.push(...p(t,e,[2,0],!0)),!N(t,s,"a8","r")&&k(t,[1,7])&&k(t,[2,7])&&k(t,[3,7])&&!$(t,[2,7],u)&&!$(t,[3,7],u)&&n.push(...p(t,e,[-2,0],!0)))),n}function st(t,s){const e=[];return s.forEach(n=>{xt(t,n)||e.push(n)}),e}function xt(t,s){const e=C(s),n=G(t,e),i=B(t,e.from);return L(n,i)}function $(t,s,e){const n=[];for(let i=0;i<=7;i++)for(let o=0;o<=7;o++)B(t,[i,o])===e&&n.push(...J(t,[],[i,o]));return!!n.find(i=>K(i.to,s))}function Lt(t,s,e){const n=[];for(let i=0;i<=7;i++)for(let o=0;o<=7;o++)g(t,[i,o])===s&&n.push(...J(t,[],[i,o]));return n.filter(i=>K(i.to,e))}function L(t,s){const e=Rt(t,s===w?"k":"K");return e?$(t,e,s===w?M:w):!1}function Kt(t,s,e){const n=C(e),i=B(t,n.from),o=s.length%2?w:M;return i!==o?!1:It(t,s,n)}function It(t,s,e){const n=C(e),i=z(t,s,n.from);return!!st(t,i).find(u=>T(u,n))}function Qt(t,s){const e=s.length%2?w:M;return D(t,e,s)}function D(t,s,e){const n=[];for(let o=0;o<=7;o++)for(let u=0;u<=7;u++)!k(t,[o,u])&&B(t,[o,u])===s&&n.push(...z(t,e,[o,u]));return st(t,n)}function Wt(t){return t.join("").replace(/\W/g,"").split("").sort().join("")}function Vt(t){const s=L(t,w),e=L(t,M);return s&&e?"Invalid - both in check":s?D(t,w,[]).length?"Black is in check":"Black is checkmated":e?D(t,M,[]).length?"White is in check":"White is checkmated":D(t,w,[]).length?D(t,M,[]).length?Wt(t)==="Kk"?"Stalemate - only kings":null:"White cannot move":"Black cannot move"}function Ft(t,s){const e=C(s);return g(t,e.from)==="P"&&e.to.y===7||g(t,e.from)==="p"&&e.to.y===0}function Ut(t,s){const e=Qt(t,s);return e.length?e[~~(Math.random()*e.length)]:null}function Et(t,s){const e=C(s),n=g(t,e.from),i=k(t,e.to)?"":"x";if(n==="P"||n==="p"){const v=e.promoteTo?"="+e.promoteTo:"";if(e.from.x===e.to.x)return P(e.to)+v;{const I=i===""?"e.p.":"";return P(e.from)[0]+"x"+P(e.to)+v+I}}if(n==="k"){if(T(e,"e8-g8"))return"O-O";if(T(e,"e8-c8"))return"O-O-O"}else if(n==="K"){if(T(e,"e1-g1"))return"O-O";if(T(e,"e1-c1"))return"O-O-O"}const o=Lt(t,n,e.to),u=o.filter(v=>v.from.y===e.from.y),l=o.filter(v=>v.from.x===e.from.x);let r;return l.length>1?u.length>1?r=P(e.from):r=P(e.from)[1]:o.length>1?r=P(e.from)[0]:r="",n.toUpperCase()+r+i+P(e.to)}const jt=E({name:"Chess",components:{ChessBoard:Mt},data(){return{move:"",board:[],selected:null,log:[],humanLog:[],playRandom:!1,status:"",aiPlaysBlack:!1,aiPlaysWhite:!1,autoRestart:!1,turnDelay:!1,gameOver:!1,showPromoteToDialog:!1,timeout:null}},computed:{moveCount(){return~~(this.log.length/2)+1},boardRender(){return this.board.map(t=>t.replace(/\./g," ").split(""))},boardString(){return this.board.join(`
`)},gameLog(){const t=[];let s=0;for(;this.humanLog.length>s;){const e=this.humanLog[s],n=this.humanLog.length>s+1?this.humanLog[s+1]:"",i=~~(s/2)+1;t.push(`${i}. ${e} ${n}
`),s+=2}return t.join("")},turn(){return this.log.length%2?"black":"white"},highlight(){const t=[];if(this.log.length){const s=C(this.log[this.log.length-1]);t.push(s.from),t.push(s.to)}return t}},mounted(){this.reset()},methods:{clickSquare(t){this.selected===null?(this.move=P(t)+"-",this.selected=t):(this.move=this.move+P(t),Ft(this.board,this.move)?this.showPromoteToDialog=!0:this.go(this.move))},promoteTo(t){this.showPromoteToDialog=!1,t?(this.move=this.move+"="+t,this.go(this.move)):(this.move="",this.selected=null)},go(t){const s=C(t);Kt(this.board,this.log,s)&&(this.humanLog.push(Et(this.board,s)||x(s).toUpperCase()),this.board=G(this.board,s),this.log.push(s),this.status=Vt(this.board),/^Stalemate/.test(this.status)&&(this.gameOver=!0)),this.move="",this.selected=null,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.act()},this.turnDelay?1e3:0)},reset(){this.board=["rnbqkbnr","pppppppp","........","........","........","........","PPPPPPPP","RNBQKBNR"],this.log=[],this.humanLog=[],this.status=null,this.gameOver=!1,this.act()},act(){if(!this.gameOver&&(this.turn==="white"&&this.aiPlaysWhite||this.turn==="black"&&this.aiPlaysBlack)){const t=Ut(this.board,this.log);t===null?this.gameOver=!0:this.go(t)}if(this.gameOver&&this.autoRestart){const t=/^Stalemate/.test(this.status)?1e3:1e4;clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.autoRestart&&this.reset()},t)}},actNow(){clearTimeout(this.timeout),this.act()}}}),R=t=>(ut("data-v-12d2d15f"),t=t(),lt(),t),Ht=R(()=>c("h1",null,"Chess",-1)),_t=R(()=>c("p",null,`
      Chess using a vue chessboard component. There is validation that allows
      only moves according to rules. The computer only plays random moves. The
      game log does not show check or checkmate.
    `,-1)),Gt=R(()=>c("p",null,[a(`
      Writing this program was an exercise in
      `),c("abbr",{title:"Test Driven Development"},"TDD"),a(` and Functional
      Programming using `),c("a",{href:"https://facebook.github.io/jest/"},"Jest"),a(`.
    `)],-1)),zt={key:0},Jt={key:1},qt=["aria-hidden"],Xt={class:"promote-dialog"},Yt=R(()=>c("p",null,"Promote to?",-1)),Zt=R(()=>c("wbr",null,null,-1)),bt=R(()=>c("wbr",null,null,-1)),te=R(()=>c("wbr",null,null,-1)),ee=R(()=>c("label",{for:"move"},"Move",-1));function se(t,s,e,n,i,o){const u=ot("chess-board");return y(),m("section",null,[Ht,a(),_t,a(),Gt,a(),c("h2",null,[t.status?V("",!0):(y(),m("span",zt,S(t.turn)+" to play",1)),a(),t.status?(y(),m("span",Jt,S(t.status),1)):V("",!0)]),a(),nt(u,{highlight:t.highlight,selected:t.selected,board:t.boardRender,onClickSquare:t.clickSquare},null,8,["highlight","selected","board","onClickSquare"]),a(),c("div",{"aria-hidden":!t.showPromoteToDialog,class:H([{show:t.showPromoteToDialog},"modal"]),tabindex:"-1",role:"dialog"},[c("fieldset",null,[c("div",Xt,[Yt,a(),c("button",{type:"button",onClick:s[0]||(s[0]=l=>t.promoteTo("Q"))},"♕"),a(),Zt,a(),c("button",{type:"button",onClick:s[1]||(s[1]=l=>t.promoteTo("R"))},"♖"),a(),bt,a(),c("button",{type:"button",onClick:s[2]||(s[2]=l=>t.promoteTo("B"))},"♗"),a(),te,a(),c("button",{type:"button",onClick:s[3]||(s[3]=l=>t.promoteTo("N"))},"♘")]),a(),c("button",{class:"negative",type:"button","data-dismiss":"modal","aria-label":"Close",onClick:s[4]||(s[4]=l=>t.promoteTo())},`
          ×
        `)])],10,qt),a(),c("fieldset",null,[c("label",null,[O(c("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>t.aiPlaysBlack=l),type:"checkbox",onChange:s[6]||(s[6]=(...l)=>t.actNow&&t.actNow(...l))},null,544),[[A,t.aiPlaysBlack]]),a(`
        Computer plays black
      `)]),a(),c("label",null,[O(c("input",{"onUpdate:modelValue":s[7]||(s[7]=l=>t.aiPlaysWhite=l),type:"checkbox",onChange:s[8]||(s[8]=(...l)=>t.actNow&&t.actNow(...l))},null,544),[[A,t.aiPlaysWhite]]),a(`
        Computer plays white
      `)]),a(),c("label",null,[O(c("input",{"onUpdate:modelValue":s[9]||(s[9]=l=>t.autoRestart=l),type:"checkbox",onChange:s[10]||(s[10]=(...l)=>t.actNow&&t.actNow(...l))},null,544),[[A,t.autoRestart]]),a(`
        Start new game automatically
      `)]),a(),c("label",null,[O(c("input",{"onUpdate:modelValue":s[11]||(s[11]=l=>t.turnDelay=l),type:"checkbox",onChange:s[12]||(s[12]=(...l)=>t.actNow&&t.actNow(...l))},null,544),[[A,t.turnDelay]]),a(`
        Turn delay
      `)])]),a(),c("fieldset",null,[ee,a(),O(c("input",{id:"move","onUpdate:modelValue":s[13]||(s[13]=l=>t.move=l),type:"text",placeholder:"Move e.g. e2-e4"},null,512),[[it,t.move]]),a(),c("button",{type:"button",onClick:s[14]||(s[14]=l=>t.go(t.move))},"Go"),a(),c("button",{type:"button",onClick:s[15]||(s[15]=l=>t.reset())},"Reset")]),a(),c("pre",null,S(t.boardString),1),a(),c("p",null,"Move "+S(t.moveCount),1),a(),c("p",null,"Game log: "+S(t.gameLog),1)])}const ie=j(jt,[["render",se],["__scopeId","data-v-12d2d15f"]]);export{ie as default};
