var N=Object.defineProperty;var X=(a,t,e)=>t in a?N(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var f=(a,t,e)=>X(a,typeof t!="symbol"?t+"":t,e);import{d as Y,_ as G,c as K,a as l,b as A,o as b,p as H,e as Q}from"./xindex.nwv0rKjI.js";function R(a,t,e,i,r){for(var o=0,n=0;n<e;++n){if(o>n)for(var h=0;h<r;++h){var c=t+o*i+h,s=t+n*i+h,m=a[c];a[c]=a[s],a[s]=m}for(var g=e;o&(g>>=1);)o&=~g;o|=g}}function B(a,t,e,i,r){for(var o=t+e*i/2,n=0;n<e/2;++n)for(var h=0;h<r;++h){var c=t+n*i+h,s=o+n*i+h,m=a[c];a[c]=a[s],a[s]=m}}function x(a,t,e,i,r,o,n){return J(a,t,e,i,r,o,!0,n)}function S(a,t,e,i,r,o,n){return J(a,t,e,i,r,o,!1,n)}function J(a,t,e,i,r,o,n,h){const c=Math.PI;for(var s=0;s<i;++s){n&&(B(a,s*o,e,r,h),B(t,s*o,e,r,h)),R(a,s*o,e,r,h),R(t,s*o,e,r,h);for(var m=n?c:-c,g=1;g<e;g+=g)for(var E=m/g,z=Math.sin(E/2),d=1,C=0,D=-2*z*z,T=Math.sin(E),y=0;y<g;++y){for(var w=y;w<e;w+=g*2)for(var W=w+g,v=0;v<h;++v){var p=s*o+w*r+v,F=s*o+W*r+v,P=a[F],U=t[F],V=P*d-U*C,O=P*C+U*d;a[F]=a[p]-V,t[F]=t[p]-O,a[p]+=V,t[p]+=O}var k=D*d-T*C,L=D*C+T*d;d+=k,C+=L}n||(B(a,s*o,e,r,h),B(t,s*o,e,r,h))}}class u{constructor(t,e,i){f(this,"width");f(this,"height");f(this,"uint32");f(this,"uint8");f(this,"isPaused",!1);f(this,"_fastPutBuffer");this.width=t,this.height=e,this._createBuffer(),i&&this.loadFromUnknownType(i)}_createBuffer(){const t=new ArrayBuffer(this.width*this.height*4);this.uint32=new Uint32Array(t),this.uint8=new Uint8ClampedArray(t)}loadFromUnknownType(t){t instanceof Uint32Array?this.loadFrom1dArray(t):t instanceof Uint8ClampedArray?this.loadFromUint8ClampedArray(t):typeof t=="function"?this.loadFromFunction(t):typeof t!==null&&(t instanceof Array?t[0]instanceof Array?this.loadFrom2dArray(t):this.loadFrom1dArray(t):this.loadFromInteger(t))}loadFromInteger(t){const e=this.width*this.height;for(let i=0;i<e;++i)this.uint32[i]=+t}loadFrom1dArray(t){const e=this.width*this.height;for(let i=0;i<e;++i)this.uint32[i]=t[i]}loadFrom2dArray(t){const e=this.width*this.height;for(let i=0;i<e;++i)this.uint32[i]=t[~~(i/this.width)][i%this.width]}loadFromUint8ClampedArray(t){const e=this.width*this.height;for(let i=0;i<e*4;++i)this.uint8[i]=t[i]}loadFromFunction(t){const e=this.width*this.height;for(let i=0;i<e;++i)this.uint32[i]=t(i,this.width,this.height,e)}static createFromImageUrl(t,e){const i=document.createElement("img");i.src=t,i.onload=()=>{e(u.createFromImage(i))}}static createFromImage(t){const e=document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),u.createFromCanvas(e)}static createFromCanvas(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return u.createFromImageData(e,t.width,t.height)}static createFromImageData(t,e,i){return new u(e,i,t.data)}clone(){return new u(this.width,this.height,this.uint8)}toCanvas(t){t=t||document.createElement("canvas"),t.width=this.width,t.height=this.height;const e=t.getContext("2d");return this.toContext(e),t}toContext(t){(!this._fastPutBuffer||this._fastPutBuffer.width!==this.width||this._fastPutBuffer.height!==this.height)&&(this._fastPutBuffer=t.createImageData(this.width,this.height)),this._fastPutBuffer.data.set(this.uint8),t.putImageData(this._fastPutBuffer,0,0)}resizeTo(t,e){const i=this.toCanvas();this.isPaused=!0,this.width=t,this.height=e,this._createBuffer(),this.isPaused=!1,(o=>{const n=document.createElement("canvas");n.width=this.width,n.height=this.height;const h=n.getContext("2d");h.drawImage(o,0,0,this.width,this.height);const c=h.getImageData(0,0,this.width,this.height).data;for(let s=0;s<c.length;s++)this.uint8[s]=c[s]}).call(this,i)}}class I{constructor(t,e,i,r,o,n){f(this,"channels");f(this,"width");f(this,"height");f(this,"real");f(this,"imag");f(this,"buffer");this.channels=t,this.width=r,this.height=o,this.real=e||new Array(r*o*4),this.imag=i||new Array(r*o*4),this.buffer=n||new u(this.width,this.height)}static createFromImageBuffer(t,e=3){const i=t.width*t.height,r=new Array(t.width*t.height*4),o=new Array(t.width*t.height*4),n=t.uint8;for(let h=0;h<i;++h)for(let c=0;c<e;++c){const s=h*4+c;r[s]=n[s]/255,o[s]=0}return new I(e,r,o,t.width,t.height,t)}static createFromImage(t,e=3){const i=u.createFromImage(t);return I.createFromImageBuffer(i,e)}clone(){const t=new Array(this.real.length);for(let i=0;i<this.real.length;i++)t[i]=this.real[i];const e=new Array(this.imag.length);for(let i=0;i<this.imag.length;i++)e[i]=this.imag[i];return new I(this.channels,t,e,this.width,this.height)}toBuffer(t){const e=new u(this.width,this.height),i=this.real,r=e.uint8,o=this.width*this.height;for(let n=0;n<o;++n){for(let h=0;h<this.channels;++h){const c=n*4+h;let s=i[c];s=s<0?0:s>1?1:s,t&&(s=Math.pow(s,1/t)),r[c]=255*s}r[n*4+3]=255}return e}toMagnitude(){const t=this.clone(),e=t.real,i=t.imag,r=t.width*t.height;for(let o=0;o<r;++o)for(let n=0;n<this.channels;++n){const h=o*4+n,c=e[h],s=i[h];e[h]=Math.sqrt(c*c+s*s)/r,i[h]=0}return t}toPhase(){const t=this.clone(),e=t.real,i=t.imag,r=t.width*t.height,o=Math.PI;for(let n=0;n<r;++n)for(let h=0;h<this.channels;++h){const c=n*4+h,s=e[c],m=i[c];e[c]=Math.atan2(m,s)/o/2+.5,i[c]=0}return t}ifft(){const t=this.clone(),e=t.width,i=t.height,r=t.real,o=t.imag;x(r,o,e,i,4,e*4,this.channels),x(r,o,i,e,e*4,4,this.channels);const n=e*i;for(let h=0;h<n;++h)for(let c=0;c<this.channels;++c){const s=h*4+c;r[s]=r[s]/n,o[s]=0}return t}fft(){const t=this.clone(),e=t.width,i=t.height,r=t.real,o=t.imag;return S(r,o,e,i,4,e*4,this.channels),S(r,o,i,e,e*4,4,this.channels),t}autoContrast(){const t=this.clone(),e=t.real,i=t.width,r=t.height,o=i*r,n=[1,1,1,1],h=[0,0,0,0];for(let c=0;c<o;++c)for(let s=0;s<this.channels;++s){const m=c*4+s,g=e[m];n[s]=Math.min(g,n[s]),h[s]=Math.max(g,h[s])}for(let c=0;c<o;++c)for(let s=0;s<this.channels;++s){const m=c*4+s;e[m]=(e[m]-n[s])/(h[s]-n[s])}return t}}const Z=I,$=Y({name:"Fft",data(){return{}},mounted(){},methods:{selectImage(a){this.start(a.target)},start(a){const t=document.getElementById("mag-canvas"),e=document.getElementById("phase-canvas"),i=document.getElementById("output-canvas"),o=Z.createFromImage(a).fft(),n=o.toMagnitude().autoContrast().toBuffer(6),h=o.toPhase().toBuffer(),c=o.ifft().toBuffer();n.toCanvas(t),h.toCanvas(e),c.toCanvas(i)}}}),j="/xlena.BUb9Ksfb.png",q="/xclown.CdsOXKCd.jpg",_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAEAAAAAC2xeJUAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAACAAAAAgAAw4TGaAAABrElEQVR42u3QPU7CYACA4VJBKMax0ahRl97h20Tc7TEa/13ARMVW1ERY/Dc9Rt1F2L47fIsaNZqORgoBCxLCHVzeAzzLo3ma3w66ck6Vw61oOa72+3ElyoWb6ljOBh2/5faclK2LV+vQvDJqekHT9KJRN28tV3zYaSfrjfndoCcX1Gm4E+VHfilcV66cDlr+j9t19NW+eLb2zQvjcej3jIZ5b5XFl511Jr1x/ztoyilVCteipfh84KvRSrirzuTig+bHXtKZsDPi0/LMO6OhFwe+YNTMS+tAvNgJJ+n++s2gLWeUF25Eubgy9PlwW53I+SD2O17Cydgp8W4dmTdGfeSfzGurJN7spJPWCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIOD/A/4Adc1Hsmi+Bw8AAAAldEVYdGRhdGU6Y3JlYXRlADIwMDktMDgtMDNUMTY6Mjg6MTYrMTA6MDCLQ4UmAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA4LTAzVDE2OjI4OjE2KzEwOjAw+h49mgAAAABJRU5ErkJggg==",tt="/xtwigs.DH0IBV-6.jpg",M=a=>(H("data-v-188cf9b9"),a=a(),Q(),a),et=M(()=>A("h1",null,"FFT",-1)),it=M(()=>A("p",null,`
      Experiments with Fast Fourier Transformations in javascript. Click an
      image at the top to show an FFT magnitude and phase image, and then the
      third image is made by comnining the two.
    `,-1)),st=M(()=>A("div",null,[A("div",null,[l(`
        Magnitude`),A("br"),l(),A("canvas",{id:"mag-canvas",width:"100",height:"100"})]),l(),A("div",null,[l(`
        Phase`),A("br"),l(),A("canvas",{id:"phase-canvas",width:"100",height:"100"})]),l(),A("div",null,[l(`
        Inverse FFT`),A("br"),l(),A("canvas",{id:"output-canvas",width:"100",height:"100"})])],-1));function nt(a,t,e,i,r,o){return b(),K("section",null,[et,l(),it,l(),A("img",{src:j,onClick:t[0]||(t[0]=(...n)=>a.selectImage&&a.selectImage(...n))}),l(),A("img",{src:q,onClick:t[1]||(t[1]=(...n)=>a.selectImage&&a.selectImage(...n))}),l(),A("img",{src:_,onClick:t[2]||(t[2]=(...n)=>a.selectImage&&a.selectImage(...n))}),l(),A("img",{src:tt,onClick:t[3]||(t[3]=(...n)=>a.selectImage&&a.selectImage(...n))}),l(),st])}const at=G($,[["render",nt],["__scopeId","data-v-188cf9b9"]]);export{at as default};
